<ui:UiPage x:Class="CrytonCoreNext.Views.AIViewerView"
            xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
            xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
            xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
            xmlns:c="clr-namespace:CrytonCoreNext.Converters"
            xmlns:viewmodels="clr-namespace:CrytonCoreNext.ViewModels" 
            d:DataContext="{d:DesignInstance Type=viewmodels:AIViewerViewModel}"
            xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
            xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml" 
            mc:Ignorable="d" 
            d:DesignHeight="1080" d:DesignWidth="1920">
    <ui:UiPage.Resources>
        <ResourceDictionary>
            <c:CollectionToVisibilityConverter x:Key="CollectionToVisibilityConverter"/>
            <c:CollectionToVisibilityInversionConverter x:Key="CollectionToVisibilityInversionConverter"/>
            <c:ReverseCollectionToVisibilityConverter x:Key="ReverseCollectionToVisibilityConverter"/>
            <c:BoolToVisibilityInversionConverter x:Key="BoolToVisibilityInversionConverter"/>
            <c:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
            <c:ObjectToVisibility x:Key="ObjectToVisibility"/>
        </ResourceDictionary>
    </ui:UiPage.Resources>
    <Grid>
        <Grid Visibility="{Binding Images, Converter={StaticResource CollectionToVisibilityInversionConverter}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="3*"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Grid x:Name="compareGrid"> 
                    <Grid HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,5"
                          Visibility="{Binding UserIsInAdjusterTab, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource BoolToVisibilityConverter}}">
                        <Image x:Name="BeforeImage" HorizontalAlignment="Left" Margin="0,0,0,20"
                               Source="{Binding SelectedImage.AdjusterImage, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                               RenderOptions.BitmapScalingMode="LowQuality" RenderOptions.EdgeMode="Unspecified"/>
                        <Rectangle HorizontalAlignment="Left" Width="{Binding Value, ElementName=Slider}" Margin="0,0,0,20">
                            <Rectangle.Fill>
                                <ImageBrush ImageSource="{Binding SelectedImage.Image, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                            RenderOptions.BitmapScalingMode="LowQuality" RenderOptions.EdgeMode="Unspecified"
                                            Stretch="UniformToFill" AlignmentX="Left" AlignmentY="Top" />
                            </Rectangle.Fill>
                        </Rectangle>
                        <Slider x:Name="Slider" VerticalAlignment="Bottom"
                                Maximum="{Binding ActualWidth, ElementName=BeforeImage}" 
                             Visibility="{Binding UserIsInAdjusterTab, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource BoolToVisibilityConverter}}"
                            Value="{Binding ImageCompareSliderValue, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                    </Grid>
                    <Image Source="{Binding SelectedImage.DetectionImage, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                           Visibility="{Binding UserIsInAdjusterTab, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource BoolToVisibilityInversionConverter}}"
                           Margin="0,5,0,25" RenderOptions.BitmapScalingMode="LowQuality" RenderOptions.EdgeMode="Unspecified"/>
                    <Grid  VerticalAlignment="Bottom" 
                          Visibility="{Binding UserIsInAdjusterTab, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource BoolToVisibilityInversionConverter}}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <ui:SymbolIcon Grid.Column="0" Visibility="{Binding UserMouseIsInDetectedObject, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource BoolToVisibilityConverter}}" 
                                       Symbol="ScanObject20" Margin="5,0" VerticalAlignment="Center" HorizontalAlignment="Right"/>
                        <TextBlock Grid.Column="1"  Margin="5,0" VerticalAlignment="Center"  HorizontalAlignment="Left"
                                   Text="{Binding SelectedDetectionImage.Label, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                    </Grid>
                </Grid>
                <TabControl Grid.Row="2" SelectedIndex="{Binding SelectedTabControlIndex, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                    <TabItem Header="Extractor">
                        <ListView ItemsSource="{Binding SelectedImage.DetectionImages, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                      SelectedItem="{Binding SelectedDetectionImage, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"        
                      ScrollViewer.VerticalScrollBarVisibility="Disabled"
                      
                              PreviewMouseWheel="ListView_PreviewMouseWheel"
                              HorizontalAlignment="Center">

                            <ListView.Resources>
                                <Style TargetType="ListViewItem">
                                    <EventSetter Event="MouseEnter" Handler="ListViewItem_MouseEnter" />
                                    <EventSetter Event="MouseLeave" Handler="ListViewItem_MouseLeave" />
                                </Style>
                            </ListView.Resources>

                            <ListView.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal" />
                                </ItemsPanelTemplate>
                            </ListView.ItemsPanel>

                            <ListView.ItemTemplate>
                                <DataTemplate >
                                    <Image Source="{Binding Image, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </TabItem>
                    <TabItem Header="Adjuster">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Auto color" FontSize="18" RenderOptions.EdgeMode="Aliased" FontWeight="Thin" HorizontalAlignment="Left"/>
                                    <TextBlock Grid.Column="1" Text="{Binding SelectedImage.AutoColorValue, StringFormat=N2}" FontSize="18" RenderOptions.EdgeMode="Aliased" FontWeight="Thin" HorizontalAlignment="Right"/>

                                </Grid>
                                <Slider Grid.Row="1" Value="{Binding SelectedImage.AutoColorValue, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Minimum="0" Maximum="1"/>
                            </Grid>
                        </Grid>
                    </TabItem>
                </TabControl>
                
            </Grid>
            <Grid Grid.Column="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="auto"/>
                    <RowDefinition Height="3*"/>
                </Grid.RowDefinitions>
                <TextBlock Text="Images" FontSize="32" Margin="0,10" HorizontalAlignment="Center"/>
                <ListView Grid.Row="1" Margin="0,0,1,0" ItemsSource="{Binding Images, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                              SelectedItem="{Binding SelectedImage, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                              ScrollViewer.HorizontalScrollBarVisibility="Disabled"  
                      HorizontalAlignment="Stretch" VerticalAlignment="Center">

                    <ListView.ItemTemplate>
                        <DataTemplate >
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="12*"/>
                                </Grid.RowDefinitions>
                                <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Text="{Binding Label, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                <Image Grid.Row="1" Source="{Binding Image, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </Grid>
        </Grid>

        <Grid Visibility="{Binding Images, Converter={StaticResource CollectionToVisibilityConverter}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
            <Frame x:Name="Background"/>
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <TextBlock Grid.Column="1" FontSize="84" Text="AI Viewer" FontFamily="Candara Light"/>
                <TextBlock Grid.Column="1" HorizontalAlignment="Center" FontSize="22" Text="Improve your sight" FontWeight="UltraLight" FontFamily="Candara Light"/>
            </StackPanel>

            <ui:Button VerticalAlignment="Center" HorizontalAlignment="Center" Margin="440,0,0,0" Cursor="Hand"
                       Width="80" Height="80" Icon="Add20" FontSize="54" ToolTip="Load files"
                       Command="{Binding LoadImagesCommand}"/> 
            <StackPanel VerticalAlignment="Bottom" HorizontalAlignment="Left" Margin="20">
                <TextBlock
                    FontSize="{StaticResource G_NormalFontSize}"
                    FontWeight="UltraLight"
                    Text="Learn more" />
                <ui:Hyperlink
                    Margin="8,8,0,0"
                    Padding="4"
                    Content="GitHub"
                    Icon="Empty"
                    NavigateUri="https://github.com/ToxicSkill/CrytonCoreNext"
                    ToolTip="https://github.com/ToxicSkill/CrytonCoreNext" />
            </StackPanel>
        </Grid>
    </Grid>
</ui:UiPage>
